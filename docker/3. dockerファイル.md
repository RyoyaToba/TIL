## 3.dockerファイル

dockerイメージを構築するための設計書にあたるもの。
dockerファイルに書かれた命令を読み込み、自動的にイメージを構築する。
dockerファイルはテキスト形式のファイルであり、イメージを構築するために必要となるすべての命令を順番通りに記述する。
詳細な書き方に関しては、[dockerfileリファレンス](https://docs.docker.jp/engine/reference/builder.html)を参照すること。

以下はgolang/mysql環境を構築するdockerファイルのサンプルを記載したものである。
サンプルとして[下記](https://docs.docker.com/samples/)にたくさん載っているので、参照されたし。

```
# syntax=docker/dockerfile:1.4
FROM --platform=$BUILDPLATFORM golang:1.18-alpine AS builder

WORKDIR /code

ENV CGO_ENABLED 0
ENV GOPATH /go
ENV GOCACHE /go-build

COPY go.mod go.sum ./
RUN --mount=type=cache,target=/go/pkg/mod/cache \
    go mod download

COPY . .

RUN --mount=type=cache,target=/go/pkg/mod/cache \
    --mount=type=cache,target=/go-build \
    go build -o bin/backend main.go

CMD ["/code/bin/backend"]

FROM builder AS dev-envs

RUN <<EOF
apk update
apk add git
EOF

RUN <<EOF
addgroup -S docker
adduser -S --shell /bin/bash --ingroup docker vscode
EOF

# install Docker tools (cli, buildx, compose)
COPY --from=gloursdocker/docker / /

CMD ["go", "run", "main.go"]

FROM scratch
COPY --from=builder /code/bin/backend /usr/local/bin/backend
CMD ["/usr/local/bin/backend"]
```

https://github.com/docker/awesome-compose/blob/master/nginx-golang-mysql/backend/Dockerfile

<br>

dockerfileの記述の書式は以下のように命令と引数で記述していく。

```
# コメント
命令 引数
```

命令は大文字と小文字を区別しないが、引数と区別をしやすくするために慣例としては命令は大文字で記載するのがお作法。

| Instruction   | Description                                                |
|---------------|------------------------------------------------------------|
| ADD           | ローカルまたはリモートのファイルやディレクトリを追加します。    |
| ARG           | ビルド時の変数を使用します。                                 |
| CMD           | デフォルトのコマンドを指定します。                           |
| COPY          | ファイルやディレクトリをコピーします。                       |
| ENTRYPOINT    | デフォルトの実行可能ファイルを指定します。                   |
| ENV           | 環境変数を設定します。                                       |
| EXPOSE        | アプリケーションがリッスンするポートを記述します。           |
| FROM          | ベースイメージから新しいビルドステージを作成します。         |
| HEALTHCHECK   | 起動時にコンテナのヘルスチェックを行います。                 |
| LABEL         | イメージにメタデータを追加します。                           |
| MAINTAINER    | イメージの作者を指定します。                                 |
| ONBUILD       | イメージがビルドに使用される際の命令を指定します。           |
| RUN           | ビルド時のコマンドを実行します。                             |
| SHELL         | イメージのデフォルトシェルを設定します。                     |
| STOPSIGNAL    | コンテナ終了時のシステムコール信号を指定します。             |
| USER          | ユーザーとグループIDを設定します。                           |
| VOLUME        | ボリュームマウントを作成します。                             |
| WORKDIR       | 作業ディレクトリを変更します。                               |


参考
https://docs.docker.jp/engine/reference/builder.html
